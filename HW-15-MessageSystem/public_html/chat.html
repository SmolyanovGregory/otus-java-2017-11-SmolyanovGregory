<html>
<head>
    <meta charset="UTF-8"/>
    <title>Simple chat</title>
    <script type="text/javascript">
        var ws;

        function init() {
            ws = new WebSocket("ws://localhost:8080/chat");

            ws.onopen = function (event) {
            }

            ws.onmessage = function (event) {
              var obj = JSON.parse(event.data);
              var textAreaField = document.getElementById("messageList");

              if (obj.responseType = "message") {
               textAreaField.value = textAreaField.value + obj.body + "\n";

              } else if (obj.responseType = "history") {
                textAreaField("messageList").value = obj.body + "\n";
              }
            }

            ws.onclose = function (event) {
            }
        };

        function sendMessage() {
            var messageField = document.getElementById("message");
            var userNameField = document.getElementById("username");
            var messageType = "message";

            var json = JSON.stringify({msgType : messageType, user : userNameField.value, message : messageField.value});
						
            ws.send(json);
            messageField.value = "";
        }

        function loadChatHistory() {
            var json = JSON.stringify({msgType : 'history'});

            ws.send(json);
        }

    </script>
</head>

<body onload="init();">

  <form name="message" action="">
    <p class="welcome">
      User name: <input id="username" value="Anonymous"/>
    </p>

    <br>

    <textarea inputtype="text" id="messageList" name="messageList" rows="20" cols="70" WRAP=virtual readonly></textarea>

	<br>

    <input name="usermsg" type="text" id="message" size="70"/>
    <input type="button" name="submitmsg" value="Send..." onclick="sendMessage();"/>
    <br>
    <br>
    <input type="button" name="loadHistory" value="Load chat history" onclick="loadChatHistory();"/>
  </form>
</body>
</html>